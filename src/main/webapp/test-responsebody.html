<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ResponseBody æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }

        .test-section h3 {
            margin-top: 0;
            color: #555;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .response {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        .input-section {
            margin: 10px 0;
        }

        input,
        textarea {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
        }

        textarea {
            width: 300px;
            height: 80px;
            vertical-align: top;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>@ResponseBody æ³¨è§£æµ‹è¯•é¡µé¢</h1>

        <!-- æ·»åŠ è°ƒè¯•ä¿¡æ¯ -->
        <div class="test-section">
            <h3>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debug-info" class="response">
                <strong>å½“å‰URL:</strong> <span id="current-url"></span><br>
                <strong>åŸºç¡€è·¯å¾„:</strong> <span id="base-path"></span><br>
                <strong>çŠ¶æ€:</strong> <span id="connection-status">æ£€æŸ¥ä¸­...</span>
            </div>
            <button onclick="checkConnection()">æ£€æŸ¥è¿æ¥</button>
            <button onclick="testBasicEndpoints()">æµ‹è¯•åŸºç¡€ç«¯ç‚¹</button>
        </div>

        <!-- åŸºæœ¬æµ‹è¯• -->
        <div class="test-section">
            <h3>1. åŸºæœ¬ç”¨æ³•æµ‹è¯•</h3>
            <button onclick="testApi('/test/simple')">ç®€å•æ•°æ®</button>
            <button onclick="testApi('/test/user')">ç”¨æˆ·å¯¹è±¡</button>
            <button onclick="testApi('/test/result')">ResultåŒ…è£…</button>
            <button onclick="testApi('/test/users')">ç”¨æˆ·åˆ—è¡¨</button>
            <div id="basic-response" class="response"></div>
        </div>

        <!-- å‚æ•°æµ‹è¯• -->
        <div class="test-section">
            <h3>2. å‚æ•°å¤„ç†æµ‹è¯•</h3>
            <div class="input-section">
                <input type="number" id="userId" placeholder="ç”¨æˆ·ID" value="123">
                <button onclick="testUserById()">æ ¹æ®IDè·å–ç”¨æˆ·</button>
            </div>
            <div class="input-section">
                <input type="text" id="keyword" placeholder="æœç´¢å…³é”®è¯" value="æµ‹è¯•">
                <input type="number" id="page" placeholder="é¡µç " value="1">
                <input type="number" id="size" placeholder="é¡µå¤§å°" value="10">
                <button onclick="testSearch()">æœç´¢æµ‹è¯•</button>
            </div>
            <div id="param-response" class="response"></div>
        </div>

        <!-- POSTæµ‹è¯• -->
        <div class="test-section">
            <h3>3. POSTè¯·æ±‚æµ‹è¯•</h3>
            <div class="input-section">
                <textarea id="userData" placeholder="ç”¨æˆ·æ•°æ®JSON">{"name": "æµ‹è¯•ç”¨æˆ·", "email": "test@example.com"}</textarea>
                <button onclick="testCreateUser()">åˆ›å»ºç”¨æˆ·</button>
            </div>
            <div id="post-response" class="response"></div>
        </div>

        <!-- é”™è¯¯å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>4. é”™è¯¯å¤„ç†æµ‹è¯•</h3>
            <button onclick="testApi('/test/error/404')">404é”™è¯¯</button>
            <button onclick="testApi('/test/error/500')">500é”™è¯¯</button>
            <button onclick="testApi('/test/error/400')">400é”™è¯¯</button>
            <button onclick="testApi('/test/error/ok')">æ­£å¸¸å“åº”</button>
            <div id="error-response" class="response"></div>
        </div>

        <!-- ç‰¹æ®Šæƒ…å†µæµ‹è¯• -->
        <div class="test-section">
            <h3>5. ç‰¹æ®Šæƒ…å†µæµ‹è¯•</h3>
            <button onclick="testApi('/test/null')">nullå€¼æµ‹è¯•</button>
            <button onclick="testApi('/test/complex')">å¤æ‚å¯¹è±¡</button>
            <button onclick="testApi('/test/performance')">æ€§èƒ½æµ‹è¯•</button>
            <div id="special-response" class="response"></div>
        </div>

        <!-- å¯¹æ¯”æµ‹è¯• -->
        <div class="test-section">
            <h3>6. å¯¹æ¯”æµ‹è¯•ï¼ˆé@ResponseBodyï¼‰</h3>
            <button onclick="testApi('/test/html')">HTMLå“åº”</button>
            <button onclick="testApi('/test/manual-json')">æ‰‹åŠ¨JSON</button>
            <div id="compare-response" class="response"></div>
        </div>
    </div>
    <script>
        // å…¨å±€å˜é‡
        let basePath = '';

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            console.log('@ResponseBodyæµ‹è¯•é¡µé¢å·²åŠ è½½');
            initializePage();
        });

        // åˆå§‹åŒ–é¡µé¢
        function initializePage() {
            // è·å–å½“å‰è·¯å¾„ä¿¡æ¯
            const currentUrl = window.location.href;
            basePath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            document.getElementById('current-url').textContent = currentUrl;
            document.getElementById('base-path').textContent = basePath;

            // è‡ªåŠ¨æ£€æŸ¥è¿æ¥
            checkConnection();
        }        // æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
        function checkConnection() {
            document.getElementById('connection-status').textContent = 'æ£€æŸ¥ä¸­...';

            // æµ‹è¯•åŸºæœ¬è¿æ¥ - ä½¿ç”¨ç»å¯¹è·¯å¾„
            fetch('/ping')
                .then(response => {
                    if (response.ok) {
                        document.getElementById('connection-status').innerHTML =
                            'âœ… è¿æ¥æ­£å¸¸ (HTTP ' + response.status + ')';
                        return response.json();
                    } else {
                        throw new Error('HTTP ' + response.status + ' ' + response.statusText);
                    }
                })
                .then(data => {
                    console.log('Pingå“åº”:', data);
                })
                .catch(error => {
                    // å¦‚æœç»å¯¹è·¯å¾„å¤±è´¥ï¼Œå°è¯•ç›¸å¯¹è·¯å¾„
                    fetch(basePath + '/ping')
                        .then(response => {
                            if (response.ok) {
                                document.getElementById('connection-status').innerHTML =
                                    'âœ… è¿æ¥æ­£å¸¸ (HTTP ' + response.status + ')';
                                return response.json();
                            } else {
                                throw new Error('HTTP ' + response.status + ' ' + response.statusText);
                            }
                        })
                        .catch(error2 => {
                            document.getElementById('connection-status').innerHTML =
                                'âŒ è¿æ¥å¤±è´¥: ' + error.message + ' / ' + error2.message;
                            console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error, error2);
                        });
                });
        }

        // æµ‹è¯•åŸºç¡€ç«¯ç‚¹
        function testBasicEndpoints() {
            const endpoints = ['/', '/ping', '/diagnostic'];
            let results = 'åŸºç¡€ç«¯ç‚¹æµ‹è¯•ç»“æœ:\n\n';

            Promise.all(endpoints.map(endpoint => {
                return fetch(basePath + endpoint)
                    .then(response => ({
                        endpoint: endpoint,
                        status: response.status,
                        statusText: response.statusText,
                        contentType: response.headers.get('content-type')
                    }))
                    .catch(error => ({
                        endpoint: endpoint,
                        error: error.message
                    }));
            })).then(responses => {
                responses.forEach(resp => {
                    if (resp.error) {
                        results += `âŒ ${resp.endpoint}: ${resp.error}\n`;
                    } else {
                        results += `âœ… ${resp.endpoint}: HTTP ${resp.status} ${resp.statusText}\n`;
                    }
                });

                document.getElementById('debug-info').textContent = results;
            });
        }        // é€šç”¨APIæµ‹è¯•å‡½æ•°
        function testApi(url, method = 'GET', data = null, responseElementId = null) {
            // ç›´æ¥ä½¿ç”¨URLï¼Œä¸æ·»åŠ basePathï¼ˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„ï¼‰
            const fullUrl = url;
            const startTime = Date.now();
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            fetch(fullUrl, options)
                .then(response => {
                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    return response.text().then(text => {
                        let result = `è¯·æ±‚URL: ${fullUrl}\n`;
                        result += `HTTP ${response.status} ${response.statusText}\n`;
                        result += `Content-Type: ${response.headers.get('content-type')}\n`;
                        result += `å“åº”æ—¶é—´: ${duration}ms\n\n`;

                        // å°è¯•æ ¼å¼åŒ–JSON
                        try {
                            const jsonData = JSON.parse(text);
                            result += JSON.stringify(jsonData, null, 2);
                        } catch (e) {
                            result += text;
                        }

                        return {
                            formatted: result,
                            success: response.ok
                        };
                    });
                })
                .then(data => {
                    const elementId = responseElementId || getResponseElementId(url);
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = data.formatted;
                        element.className = `response ${data.success ? 'success' : 'error'}`;
                    }
                })
                .catch(error => {
                    const elementId = responseElementId || getResponseElementId(url);
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.textContent = `è¯·æ±‚å¤±è´¥: ${error.message}\nè¯·æ±‚URL: ${fullUrl}`;
                        element.className = 'response error';
                    }
                });
        }

        // æ ¹æ®URLç¡®å®šå“åº”æ˜¾ç¤ºå…ƒç´ 
        function getResponseElementId(url) {
            if (url.includes('/test/user') || url.includes('/test/simple') || url.includes('/test/result')) {
                return 'basic-response';
            } else if (url.includes('/test/error')) {
                return 'error-response';
            } else if (url.includes('/test/null') || url.includes('/test/complex') || url.includes('/test/performance')) {
                return 'special-response';
            } else if (url.includes('/test/html') || url.includes('/test/manual')) {
                return 'compare-response';
            } else {
                return 'param-response';
            }
        }        // æ ¹æ®IDè·å–ç”¨æˆ·
        function testUserById() {
            const userId = document.getElementById('userId').value;
            testApi(`/test/user/${userId}`, 'GET', null, 'param-response');
        }

        // æœç´¢æµ‹è¯•
        function testSearch() {
            const keyword = document.getElementById('keyword').value;
            const page = document.getElementById('page').value;
            const size = document.getElementById('size').value;
            const url = `/test/search?keyword=${encodeURIComponent(keyword)}&page=${page}&size=${size}`;
            testApi(url, 'GET', null, 'param-response');
        }

        // åˆ›å»ºç”¨æˆ·æµ‹è¯•
        function testCreateUser() {
            try {
                const userData = JSON.parse(document.getElementById('userData').value);
                testApi('/test/user', 'POST', userData, 'post-response');
            } catch (e) {
                document.getElementById('post-response').textContent = `JSONæ ¼å¼é”™è¯¯: ${e.message}`;
                document.getElementById('post-response').className = 'response error';
            }
        }
    </script>
</body>

</html>